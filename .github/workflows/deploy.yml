- name: Restart backend container (stable SSH)
  uses: appleboy/ssh-action@v0.1.7
  with:
    host: ${{ secrets.LIGHTSAIL_HOST }}
    username: ${{ secrets.LIGHTSAIL_USER }}
    key: ${{ secrets.LIGHTSAIL_SSH_KEY }}
    script_stop: true
    script: |
      set -e
      cd /home/ubuntu/growthtrail-ai

      echo "Stopping old containers..."
      docker compose down || true

      echo "Rebuilding and starting containers..."
      docker compose up -d --build

      echo "Waiting for backend to boot..."
      sleep 5

      echo "Health check..."
      curl -f http://localhost:8081/health
